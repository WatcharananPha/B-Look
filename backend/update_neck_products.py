"""
Script ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:
1. ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô ‡∏ä‡∏ô‡∏¥‡∏î‡∏ú‡πâ‡∏≤ (FabricType) ‡πÅ‡∏•‡∏∞ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏Ç‡∏ô (SleeveType)
2. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
"""

import logging
import sys
import os

sys.path.append(os.path.dirname(os.path.dirname(os.path.abspath(__file__))))

from sqlalchemy.orm import Session
from app.db.session import SessionLocal
from app.db.base import Base
from app.models.product import FabricType, NeckType, SleeveType

logging.basicConfig(level=logging.INFO)
logger = logging.getLogger(__name__)


# ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏£‡∏∞‡∏ö‡∏∏)
NECK_PRODUCTS = [
    {"name": "‡∏Ñ‡∏≠‡∏Å‡∏•‡∏°", "cost_price": 0, "extra_note": ""},
    {"name": "‡∏Ñ‡∏≠‡∏ß‡∏µ‡∏ä‡∏ô", "cost_price": 0, "extra_note": ""},
    {"name": "‡∏Ñ‡∏≠‡∏ß‡∏µ‡πÑ‡∏Ç‡∏ß‡πâ", "cost_price": 0, "extra_note": ""},
    {"name": "‡∏Ñ‡∏≠‡∏ß‡∏µ‡∏ï‡∏±‡∏î", "cost_price": 0, "extra_note": ""},
    {"name": "‡∏Ñ‡∏≠‡∏ß‡∏µ‡∏õ‡∏Å", "cost_price": 0, "extra_note": ""},
    {"name": "‡∏Ñ‡∏≠‡∏´‡πâ‡∏≤‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°", "cost_price": 0, "extra_note": ""},
    {
        "name": "‡∏Ñ‡∏≠‡∏õ‡∏Å‡∏Ñ‡∏≤‡∏á‡∏´‡∏°‡∏π (‡∏°‡∏µ‡∏•‡∏¥‡πâ‡∏ô)",
        "cost_price": 40,
        "extra_note": "‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÑ‡∏´‡∏•‡πà‡∏™‡πÇ‡∏•‡∏õ+40 ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏±‡∏ß",
    },
    {"name": "‡∏Ñ‡∏≠‡∏´‡∏¢‡∏î‡∏ô‡πç‡πâ‡∏≤", "cost_price": 40, "extra_note": "‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÑ‡∏´‡∏•‡πà‡∏™‡πÇ‡∏•‡∏õ+40 ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏±‡∏ß"},
    {
        "name": "‡∏Ñ‡∏≠‡∏´‡πâ‡∏≤‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏Ñ‡∏≤‡∏á‡∏´‡∏°‡∏π (‡∏°‡∏µ‡∏•‡∏¥‡πâ‡∏ô)",
        "cost_price": 40,
        "extra_note": "‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÑ‡∏´‡∏•‡πà‡∏™‡πÇ‡∏•‡∏õ+40 ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏±‡∏ß",
    },
    {
        "name": "‡∏Ñ‡∏≠‡∏´‡πâ‡∏≤‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏°‡∏Ñ‡∏≤‡∏á‡∏´‡∏°‡∏π (‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏¥‡πâ‡∏ô)",
        "cost_price": 40,
        "extra_note": "‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÑ‡∏´‡∏•‡πà‡∏™‡πÇ‡∏•‡∏õ+40 ‡∏ö‡∏≤‡∏ó/‡∏ï‡∏±‡∏ß",
    },
    {"name": "‡∏Ñ‡∏≠‡∏à‡∏µ‡∏ô", "cost_price": 0, "extra_note": ""},
    {"name": "‡∏Ñ‡∏≠‡∏ß‡∏µ‡∏õ‡∏Å (‡∏°‡∏µ‡∏•‡∏¥‡πâ‡∏ô)", "cost_price": 0, "extra_note": ""},
    {"name": "‡∏Ñ‡∏≠‡πÇ‡∏õ‡πÇ‡∏•", "cost_price": 0, "extra_note": ""},
    {"name": "‡∏Ñ‡∏≠‡∏ß‡∏≤‡∏¢", "cost_price": 0, "extra_note": ""},
    {"name": "‡∏Ñ‡∏≠‡πÄ‡∏ä‡∏¥‡πâ‡∏ï‡∏ê‡∏≤‡∏ô‡∏ï‡∏±‡πâ‡∏á", "cost_price": 0, "extra_note": ""},
]


def update_products():
    """
    ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:
    1. ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô ‡∏ä‡∏ô‡∏¥‡∏î‡∏ú‡πâ‡∏≤ ‡πÅ‡∏•‡∏∞ ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏Ç‡∏ô
    2. ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏≠‡∏¢‡∏π‡πà‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
    3. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡πÉ‡∏´‡∏°‡πà‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏Å‡∏≥‡∏´‡∏ô‡∏î
    """
    db = SessionLocal()
    try:
        # --- 1. ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô ‡∏ä‡∏ô‡∏¥‡∏î‡∏ú‡πâ‡∏≤ (FabricType) ---
        logger.info("üóëÔ∏è  ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô '‡∏ä‡∏ô‡∏¥‡∏î‡∏ú‡πâ‡∏≤'...")
        fabric_count = db.query(FabricType).delete()
        db.commit()
        logger.info(f"‚úÖ ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡πâ‡∏≤ {fabric_count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")

        # --- 2. ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏Ç‡∏ô (SleeveType) ---
        logger.info("üóëÔ∏è  ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô '‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏Ç‡∏ô'...")
        sleeve_count = db.query(SleeveType).delete()
        db.commit()
        logger.info(f"‚úÖ ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÅ‡∏Ç‡∏ô {sleeve_count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")

        # --- 3. ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ---
        logger.info("üóëÔ∏è  ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î...")
        neck_count = db.query(NeckType).delete()
        db.commit()
        logger.info(f"‚úÖ ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡πÄ‡∏î‡∏¥‡∏° {neck_count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")

        # --- 4. ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡πÉ‡∏´‡∏°‡πà ---
        logger.info("‚ûï ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡πÉ‡∏´‡∏°‡πà...")
        added_count = 0
        for neck in NECK_PRODUCTS:
            new_neck = NeckType(
                name=neck["name"],
                cost_price=neck["cost_price"],
                price_adjustment=0,
                additional_cost=neck["cost_price"],
                quantity=0,
                is_active=True,
            )
            db.add(new_neck)
            added_count += 1
            logger.info(
                f"  ‚úì ‡πÄ‡∏û‡∏¥‡πà‡∏°: {neck['name']}"
                + (f" ({neck['extra_note']})" if neck["extra_note"] else "")
            )

        db.commit()
        logger.info(f"‚úÖ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡πÉ‡∏´‡∏°‡πà {added_count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢")

        # --- ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏•‡∏±‡∏û‡∏ò‡πå ---
        logger.info("\n" + "=" * 60)
        logger.info("üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:")
        logger.info(f"   üóëÔ∏è  ‡∏•‡∏ö‡∏ä‡∏ô‡∏¥‡∏î‡∏ú‡πâ‡∏≤: {fabric_count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")
        logger.info(f"   üóëÔ∏è  ‡∏•‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏Ç‡∏ô: {sleeve_count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")
        logger.info(f"   üóëÔ∏è  ‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡πÄ‡∏î‡∏¥‡∏°: {neck_count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")
        logger.info(f"   ‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏Ñ‡∏≠‡πÉ‡∏´‡∏°‡πà: {added_count} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£")
        logger.info("=" * 60)

    except Exception as e:
        logger.error(f"‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î: {e}")
        db.rollback()
    finally:
        db.close()


if __name__ == "__main__":
    logger.info("üöÄ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤...")
    logger.info("")
    update_products()
    logger.info("\nüèÅ ‡∏Å‡∏≤‡∏£‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ó‡πÄ‡∏™‡∏£‡πá‡∏à‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå")
