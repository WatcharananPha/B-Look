import os
from sqlalchemy import create_engine, text

# 1. à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸µà¹ˆà¸–à¸¹à¸à¸•à¹‰à¸­à¸‡ 100% (à¸«à¹‰à¸²à¸¡à¹à¸à¹‰à¹„à¸‚)
NECK_TYPES = [
    "à¸„à¸­à¸à¸¥à¸¡",
    "à¸„à¸­à¸§à¸µà¸Šà¸™",
    "à¸„à¸­à¸§à¸µà¹„à¸‚à¸§à¹‰",
    "à¸„à¸­à¸§à¸µà¸•à¸±à¸”",
    "à¸„à¸­à¸§à¸µà¸›à¸",
    "à¸„à¸­à¸«à¹‰à¸²à¹€à¸«à¸¥à¸µà¹ˆà¸¢à¸¡",
    "à¸„à¸­à¸›à¸à¸„à¸²à¸‡à¸«à¸¡à¸¹ (à¸¡à¸µà¸¥à¸´à¹‰à¸™) (à¸šà¸±à¸‡à¸„à¸±à¸šà¹„à¸«à¸¥à¹ˆà¸ªà¹‚à¸¥à¸›+40 à¸šà¸²à¸—/à¸•à¸±à¸§)",
    "à¸„à¸­à¸«à¸¢à¸”à¸™à¹à¹‰à¸² (à¸šà¸±à¸‡à¸„à¸±à¸šà¹„à¸«à¸¥à¹ˆà¸ªà¹‚à¸¥à¸›+40 à¸šà¸²à¸—/à¸•à¸±à¸§)",
    "à¸„à¸­à¸«à¹‰à¸²à¹€à¸«à¸¥à¸µà¹ˆà¸¢à¸¡à¸„à¸²à¸‡à¸«à¸¡à¸¹ (à¸¡à¸µà¸¥à¸´à¹‰à¸™) (à¸šà¸±à¸‡à¸„à¸±à¸šà¹„à¸«à¸¥à¹ˆà¸ªà¹‚à¸¥à¸›+40 à¸šà¸²à¸—/à¸•à¸±à¸§)",
    "à¸„à¸­à¸«à¹‰à¸²à¹€à¸«à¸¥à¸µà¹ˆà¸¢à¸¡à¸„à¸²à¸‡à¸«à¸¡à¸¹ (à¹„à¸¡à¹ˆà¸¡à¸µà¸¥à¸·à¹ˆà¸™) (à¸šà¸±à¸‡à¸„à¸±à¸šà¹„à¸«à¸¥à¹ˆà¸ªà¹‚à¸¥à¸›+40 à¸šà¸²à¸—/à¸•à¸±à¸§)",
    "à¸„à¸­à¸ˆà¸µà¸™",
    "à¸„à¸­à¸§à¸µà¸›à¸ (à¸¡à¸µà¸¥à¸´à¹‰à¸™)",
    "à¸„à¸­à¹‚à¸›à¹‚à¸¥",
    "à¸„à¸­à¸§à¸²à¸¢",
    "à¸„à¸­à¹€à¸Šà¸´à¹‰à¸•à¸à¸²à¸™à¸•à¸±à¹‰à¸‡"
]

# 2. à¹€à¸Šà¸·à¹ˆà¸­à¸¡à¸•à¹ˆà¸­ Database Azure
db_url = 'postgresql+psycopg2://blookadmin:StrongP%40ssw0rd123%21@blook-db-10314.postgres.database.azure.com:5432/blook_db?sslmode=require'
engine = create_engine(db_url)

with engine.connect() as conn:
    print("ðŸš€ Starting Database Update...")
    
    # 3. à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹€à¸à¹ˆà¸²à¸—à¸´à¹‰à¸‡ (à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰à¹à¸™à¹ˆà¹ƒà¸ˆà¸§à¹ˆà¸²à¹„à¸¡à¹ˆà¸¡à¸µà¸­à¸±à¸™à¹€à¸à¹ˆà¸²à¸›à¸™)
    # à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸: à¸–à¹‰à¸²à¸¡à¸µ Order à¹ƒà¸Šà¹‰à¸­à¸¢à¸¹à¹ˆ à¸­à¸²à¸ˆà¸ˆà¸°à¸•à¸´à¸” FK à¹à¸•à¹ˆà¸–à¹‰à¸²à¹€à¸›à¹‡à¸™à¸£à¸°à¸šà¸šà¹ƒà¸«à¸¡à¹ˆà¸„à¸§à¸£à¸¥à¸šà¹„à¸”à¹‰
    try:
        conn.execute(text("DELETE FROM neck_types;"))
        print("âœ… Cleared old neck_types.")
    except Exception as e:
        print(f"âš ï¸ Warning cleaning table: {e}")

    # 4. à¸§à¸™à¸¥à¸¹à¸›à¹ƒà¸ªà¹ˆà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹ƒà¸«à¸¡à¹ˆ
    for name in NECK_TYPES:
        # à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¹€à¸‡à¸·à¹ˆà¸­à¸™à¹„à¸‚à¸£à¸²à¸„à¸²à¹à¸¥à¸° Slope à¸ˆà¸²à¸à¸Šà¸·à¹ˆà¸­
        is_slope = "à¸šà¸±à¸‡à¸„à¸±à¸šà¹„à¸«à¸¥à¹ˆà¸ªà¹‚à¸¥à¸›" in name
        add_cost = 40 if "+40" in name else 0
        
        sql = text(\"\"\"
            INSERT INTO neck_types (name, force_slope, additional_cost, is_active)
            VALUES (:name, :slope, :cost, true)
        \"\"\")
        
        conn.execute(sql, {
            'name': name,
            'slope': is_slope,
            'cost': add_cost
        })
        print(f"   -> Inserted: {name}")

    conn.commit()
    print("âœ… All neck types updated successfully!")
